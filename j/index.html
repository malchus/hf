<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HolyFlip! Bible Discovery Tool</title>
<style>
.flip {width:400px}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script>
$(document).ready(function(){

	
p1 = document.URL.split('&');																	// Variable to pull parameters from URl


if ( p1[1] ) {
		newFlip = "/a/bible/api/" + $( "#switchVersion" ).val() + "/" + p1[3] + "/" + p1[4] + "/" + p1[5];
		ShowVerse(newFlip);
		
		
	} else {  															// idea to determine if user is using bookmark or initiating newflip //
		newFlip = "/a/bible/flip/json/" + $( "#switchVersion" ).val();
		
		
}

// Function that grabs verses from drupal api  and displays it to a page. //
function ShowVerse (call) {																		// call is path to json api //
	$.getJSON(call, function( data ) {															// Json Call to api //
  	var items = [];																				// Place holder for verse array //
  	var verses = data.nodes.length // Number of Verse passed through JSON to display.			// Count the number of verses from call //
  	var verseLoop=0; // Counter for display verses.												// Counter for while loop //
  	translation = data.nodes[0].node.Synonyms;			
  	book = data.nodes[0].node.field_book;
  	chapter = data.nodes[0].node.field_chapter;
  	verse = data.nodes[0].node.field_verse;
  	while (verseLoop < verses) {
  		items.push( '<h2 class="verse">' + data.nodes[verseLoop].node.title + '</h2><p>' + data.nodes[verseLoop].node.body + '</p><span>' + data.nodes[verseLoop].node.field_translation + '</span>');
  		verseLoop++ }
	$( ".flip" ).empty().append(items);	
		history.pushState(null, "", "?&verse&" + translation + "&" + book + "&" + chapter + "&" + verse );	
		$(document).prop('title', data.nodes[0].node.title + ' | HolyFlip!'); 				// Change the Page title //
		
		

});


}
// End Grabber Function //


// Flip //
$( "#switch" ).click(function () {
	
 ShowVerse("/a/bible/flip/json/" + $( "#switchVersion" ).val());
 window.onpopstate = function(event) {
			
	p2 = document.URL.split('&');
		newFlip2 = "/j/?&verse&" + $( "#switchVersion" ).val() + "&" + p2[3] + "&" + p2[4] + "&" + p2[5];
  		window.location.replace(newFlip2);		
  		
  					// Adds URL of the New Flip for Bookmarking purposes //
		
	};
 
});


// End Flip//

// make a history (most recent five verses) can also use this to help with back button problem. ///

});




</script>
</head>

<body>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NN3HMP"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NN3HMP');</script>
<!-- End Google Tag Manager -->

<h1 class="title">HolyFlip! 2</h1>

    <select id="switchVersion">
    
      <option value="kjv">KJV</option>
      <option value="asv">ASV</option>
    </select>
    <a  id="switch">HolyFlip!</a>
  </fieldset>


<div class="flip">


</div>

<h3>Debug</h3>
<div class="debug">
</div>

<div class="test">
<div>
Hi
</div>
</body>

</html>
